trigger:
  branches:
    include:
      - main
      - develop
      - feature/*
  paths:
    include:
      - test/*



# ---------- ZeitÂ­gesteuerter Trigger (Nightly) ----------
schedules:
- cron: "*/2 * * * *"         # alle 2 Minuten
  displayName: "Alle 2 Minuten"
  branches:
    include: [ main ]
  always: true


# ---------- Pipelineâ€‘Completion ----------
resources:
  pipelines:
  - pipeline: kontrollstrukturen_build        
    source: Kontrollstrukturen                
    branch: refs/heads/main                   
    trigger:
      branches:
        include:
          - main


pool:
  name: MahlzeitExpress

# ---------- Stages ----------
stages:
# --- Build -------------------------------------------------------
- stage: Build
  jobs:
  - job: BuildJob
    steps:
    # ---- Runâ€‘Info: Grund und Quelle ausgeben ----
    - script: |
        echo "ğŸ Pipelineâ€‘Startgrund: $(Build.Reason)"
        echo "ğŸ”€ Quelle:            $(Build.SourceBranch)"
        echo "ğŸ”– Commitâ€‘Msg:        $(Build.SourceVersionMessage)"
      displayName: "Runâ€‘Info"


# --- Test --------------------------------------------------------
- stage: Test
  dependsOn: Build
  condition: succeeded('Build')
  jobs:
  - job: TestJob
    steps:
    - script: echo "ğŸ§ª Starte Testsâ€¦"
      displayName: "Unitâ€‘Tests"

# --- Deploy (lÃ¤uft nur auf main) --------------------------------
- stage: Deploy
  dependsOn: Test
  condition: and(succeeded('Test'), eq(variables['Build.SourceBranch'], 'refs/heads/main'))
  jobs:
  - job: ReleaseJob
    steps:
    - script: echo "ğŸš€ Deployment auf PROD"
      displayName: "Release"